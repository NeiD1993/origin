
Процедура ОбработкаПроведения(Отказ, Режим)
	//{{__КОНСТРУКТОР_ДВИЖЕНИЙ_РЕГИСТРОВ
	// Данный фрагмент построен конструктором.
	// При повторном использовании конструктора, внесенные вручную изменения будут утеряны!!!
	
	// регистр ДвижениеКниг Расход
	Движения.ДвижениеКниг.Записывать = Истина;
	Книги.Сортировать("Сектор, Код");
	КоличествоОдинаковых = 1;
	КоличествоИтераций = Книги.Количество() - 1;
	Для Счетчик = 0 По (КоличествоИтераций) Цикл
		Если Счетчик = 0 Тогда
			ТекущаяСтрока = Книги[Счетчик];
		Иначе
			Если ((Книги[Счетчик].Сектор = ТекущаяСтрока.Сектор) И 
				  (Книги[Счетчик].Код = ТекущаяСтрока.Код)) Тогда
				  КоличествоОдинаковых = КоличествоОдинаковых + 1;
			Иначе
				ДобавлениеДвижения(ТекущаяСтрока, КоличествоОдинаковых);
				ТекущаяСтрока = Книги[Счетчик];
				КоличествоОдинаковых = 1;
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;
	ДобавлениеДвижения(ТекущаяСтрока, КоличествоОдинаковых);
	
	// регистр ДвижениеЭкземпляровКниг
	Движения.ДвижениеЭкземпляровКниг.Записывать = Истина;
	Для Каждого ТекСтрокаКниги Из Книги Цикл
		Движение = Движения.ДвижениеЭкземпляровКниг.Добавить();
		Движение.Период = Дата;
		Движение.ВидКниги = ТекСтрокаКниги.Вид;
		Движение.Сектор = ТекСтрокаКниги.Сектор;
		Движение.Код = ТекСтрокаКниги.Код;
		Движение.РегистрационныйНомер = ТекСтрокаКниги.РегистрационныйНомер;
		Движение.Статус = Перечисления.СтатусКниги.Списано; 
		Движение.Название = ТекСтрокаКниги.Название;
		Движение.Автор = ТекСтрокаКниги.Автор;
	КонецЦикла;

	//}}__КОНСТРУКТОР_ДВИЖЕНИЙ_РЕГИСТРОВ
КонецПроцедуры

Процедура ДобавлениеДвижения(ТекСтрокаКниги, КоличествоОдинаковых)
	Движение = Движения.ДвижениеКниг.Добавить();
	Движение.ВидДвижения = ВидДвиженияНакопления.Расход;
	Движение.Период = Дата;
	Движение.Вид = ТекСтрокаКниги.Вид;
	Движение.Сектор = ТекСтрокаКниги.Сектор;
	Движение.Код = ТекСтрокаКниги.Код;
	Движение.Количество = КоличествоОдинаковых;
	Движение.Название = ТекСтрокаКниги.Название;
	Движение.Автор = ТекСтрокаКниги.Автор;
КонецПроцедуры




